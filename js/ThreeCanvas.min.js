var THREE=THREE||{};if(!self.Int32Array){self.Int32Array=Array,self.Float32Array=Array}THREE.Color=function(b){b!==void 0&&this.setHex(b);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(b){this.r=b.r;this.g=b.g;this.b=b.b;return this},copyGammaToLinear:function(b){this.r=b.r*b.r;this.g=b.g*b.g;this.b=b.b*b.b;return this},copyLinearToGamma:function(b){this.r=Math.sqrt(b.r);this.g=Math.sqrt(b.g);this.b=Math.sqrt(b.b);return this},setRGB:function(e,d,f){this.r=e;this.g=d;this.b=f;return this},setHSV:function(h,g,l){var k,i,j;if(l===0){this.r=this.g=this.b=0}else{switch(k=Math.floor(h*6),i=h*6-k,h=l*(1-g),j=l*(1-g*i),g=l*(1-g*(1-i)),k){case 1:this.r=j;this.g=l;this.b=h;break;case 2:this.r=h;this.g=l;this.b=g;break;case 3:this.r=h;this.g=j;this.b=l;break;case 4:this.r=g;this.g=h;this.b=l;break;case 5:this.r=l;this.g=h;this.b=j;break;case 6:case 0:this.r=l,this.g=g,this.b=h}}return this},setHex:function(b){b=Math.floor(b);this.r=(b>>16&255)/255;this.g=(b>>8&255)/255;this.b=(b&255)/255;return this},getHex:function(){return ~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(d,c){this.x=d||0;this.y=c||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(d,c){this.x=d;this.y=c;return this},copy:function(b){this.x=b.x;this.y=b.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;return this},subSelf:function(b){this.x-=b.x;this.y-=b.y;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;return this},divideScalar:function(b){b?(this.x/=b,this.y/=b):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(d){var c=this.x-d.x,d=this.y-d.y;return c*c+d*d},setLength:function(b){return this.normalize().multiplyScalar(b)},equals:function(b){return b.x===this.x&&b.y===this.y}};THREE.Vector3=function(e,d,f){this.x=e||0;this.y=d||0;this.z=f||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,d,f){this.x=e;this.y=d;this.z=f;return this},setX:function(b){this.x=b;return this},setY:function(b){this.y=b;return this},setZ:function(b){this.z=b;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addScalar:function(b){this.x+=b;this.y+=b;this.z+=b;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;return this},subSelf:function(b){this.x-=b.x;this.y-=b.y;this.z-=b.z;return this},multiply:function(d,c){this.x=d.x*c.x;this.y=d.y*c.y;this.z=d.z*c.z;return this},multiplySelf:function(b){this.x*=b.x;this.y*=b.y;this.z*=b.z;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;return this},divideSelf:function(b){this.x/=b.x;this.y/=b.y;this.z/=b.z;return this},divideScalar:function(b){b?(this.x/=b,this.y/=b,this.z/=b):this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.normalize().multiplyScalar(b)},cross:function(d,c){this.x=d.y*c.z-d.z*c.y;this.y=d.z*c.x-d.x*c.z;this.z=d.x*c.y-d.y*c.x;return this},crossSelf:function(f){var e=this.x,h=this.y,g=this.z;this.x=h*f.z-g*f.y;this.y=g*f.x-e*f.z;this.z=e*f.y-h*f.x;return this},distanceTo:function(b){return Math.sqrt(this.distanceToSquared(b))},distanceToSquared:function(b){return(new THREE.Vector3).sub(this,b).lengthSq()},setPositionFromMatrix:function(b){this.x=b.n14;this.y=b.n24;this.z=b.n34},setRotationFromMatrix:function(d){var c=Math.cos(this.y);this.y=Math.asin(d.n13);Math.abs(c)>0.00001?(this.x=Math.atan2(-d.n23/c,d.n33/c),this.z=Math.atan2(-d.n12/c,d.n11/c)):(this.x=0,this.z=Math.atan2(d.n21,d.n22))},isZero:function(){return this.lengthSq()<0.0001}};THREE.Vector4=function(f,e,h,g){this.x=f||0;this.y=e||0;this.z=h||0;this.w=g!==void 0?g:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(f,e,h,g){this.x=f;this.y=e;this.z=h;this.w=g;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w!==void 0?b.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;this.w=d.w+c.w;return this},addSelf:function(b){this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;this.w=d.w-c.w;return this},subSelf:function(b){this.x-=b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;this.w*=b;return this},divideScalar:function(b){b?(this.x/=b,this.y/=b,this.z/=b,this.w/=b):(this.z=this.y=this.x=0,this.w=1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z+this.w*b.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(b){return this.normalize().multiplyScalar(b)},lerpSelf:function(d,c){this.x+=(d.x-this.x)*c;this.y+=(d.y-this.y)*c;this.z+=(d.z-this.z)*c;this.w+=(d.w-this.w)*c;return this}};THREE.Ray=function(X,W){function V(e,d,f){N.sub(f,e);E=N.dot(d);if(E<=0){return null}L=H.add(e,G.copy(d).multiplyScalar(E));return A=f.distanceTo(L)}function U(f,e,h,g){N.sub(g,e);H.sub(h,e);G.sub(f,e);u=N.dot(N);B=N.dot(H);q=N.dot(G);r=H.dot(H);v=H.dot(G);x=1/(u*r-B*B);t=(r*q-B*v)*x;y=(u*v-B*q)*x;return t>=0&&y>=0&&t+y<1}this.origin=X||new THREE.Vector3;this.direction=W||new THREE.Vector3;this.intersectScene=function(b){return this.intersectObjects(b.children)};this.intersectObjects=function(f){var e,h,g=[];e=0;for(h=f.length;e<h;e++){Array.prototype.push.apply(g,this.intersectObject(f[e]))}g.sort(function(d,c){return d.distance-c.distance});return g};var S=new THREE.Vector3,T=new THREE.Vector3,R=new THREE.Vector3,P=new THREE.Vector3,X=new THREE.Vector3,W=new THREE.Vector3,I=new THREE.Vector3,J=new THREE.Vector3,M=new THREE.Vector3;this.intersectObject=function(e){for(var f,b=[],c=0,d=e.children.length;c<d;c++){Array.prototype.push.apply(b,this.intersectObject(e.children[c]))}if(e instanceof THREE.Particle){c=V(this.origin,this.direction,e.matrixWorld.getPosition());if(c===null||c>e.scale.x){return[]}f={distance:c,point:e.position,face:null,object:e};b.push(f)}else{if(e instanceof THREE.Mesh){c=V(this.origin,this.direction,e.matrixWorld.getPosition());if(c===null||c>e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z))){return b}var a,j=e.geometry,h=j.vertices,g;e.matrixRotationWorld.extractRotation(e.matrixWorld);c=0;for(d=j.faces.length;c<d;c++){if(f=j.faces[c],X.copy(this.origin),W.copy(this.direction),g=e.matrixWorld,I=g.multiplyVector3(I.copy(f.centroid)).subSelf(X),a=I.dot(W),!(a<=0)&&(S=g.multiplyVector3(S.copy(h[f.a].position)),T=g.multiplyVector3(T.copy(h[f.b].position)),R=g.multiplyVector3(R.copy(h[f.c].position)),f instanceof THREE.Face4&&(P=g.multiplyVector3(P.copy(h[f.d].position))),J=e.matrixRotationWorld.multiplyVector3(J.copy(f.normal)),a=W.dot(J),e.doubleSided||(e.flipSided?a>0:a<0))){if(a=J.dot(I.sub(S,X))/a,M.add(X,W.multiplyScalar(a)),f instanceof THREE.Face3){U(M,S,T,R)&&(f={distance:X.distanceTo(M),point:M.clone(),face:f,object:e},b.push(f))}else{if(f instanceof THREE.Face4&&(U(M,S,T,P)||U(M,T,R,P))){f={distance:X.distanceTo(M),point:M.clone(),face:f,object:e},b.push(f)}}}}}}return b};var N=new THREE.Vector3,H=new THREE.Vector3,G=new THREE.Vector3,E,L,A,u,B,q,r,v,x,t,y};THREE.Rectangle=function(){function j(){n=o-i;l=m-p}var i,p,o,m,n,l,k=!0;this.getX=function(){return i};this.getY=function(){return p};this.getWidth=function(){return n};this.getHeight=function(){return l};this.getLeft=function(){return i};this.getTop=function(){return p};this.getRight=function(){return o};this.getBottom=function(){return m};this.set=function(d,c,a,b){k=!1;i=d;p=c;o=a;m=b;j()};this.addPoint=function(b,a){k?(k=!1,i=b,p=a,o=b,m=a):(i=i<b?i:b,p=p<a?p:a,o=o>b?o:b,m=m>a?m:a);j()};this.add3Points=function(d,c,a,b,h,f){k?(k=!1,i=d<a?d<h?d:h:a<h?a:h,p=c<b?c<f?c:f:b<f?b:f,o=d>a?d>h?d:h:a>h?a:h,m=c>b?c>f?c:f:b>f?b:f):(i=d<a?d<h?d<i?d:i:h<i?h:i:a<h?a<i?a:i:h<i?h:i,p=c<b?c<f?c<p?c:p:f<p?f:p:b<f?b<p?b:p:f<p?f:p,o=d>a?d>h?d>o?d:o:h>o?h:o:a>h?a>o?a:o:h>o?h:o,m=c>b?c>f?c>m?c:m:f>m?f:m:b>f?b>m?b:m:f>m?f:m);j()};this.addRectangle=function(a){k?(k=!1,i=a.getLeft(),p=a.getTop(),o=a.getRight(),m=a.getBottom()):(i=i<a.getLeft()?i:a.getLeft(),p=p<a.getTop()?p:a.getTop(),o=o>a.getRight()?o:a.getRight(),m=m>a.getBottom()?m:a.getBottom());j()};this.inflate=function(a){i-=a;p-=a;o+=a;m+=a;j()};this.minSelf=function(a){i=i>a.getLeft()?i:a.getLeft();p=p>a.getTop()?p:a.getTop();o=o<a.getRight()?o:a.getRight();m=m<a.getBottom()?m:a.getBottom();j()};this.intersects=function(b){return Math.min(o,b.getRight())-Math.max(i,b.getLeft())>=0&&Math.min(m,b.getBottom())-Math.max(p,b.getTop())>=0};this.empty=function(){k=!0;m=o=p=i=0;j()};this.isEmpty=function(){return k}};THREE.Math={clamp:function(e,d,f){return e<d?d:e>f?f:e},clampBottom:function(d,c){return d<c?c:d},mapLinear:function(g,e,j,i,h){return i+(g-e)*(h-i)/(j-e)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}};THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var d,c=this.m;d=c[1];c[1]=c[3];c[3]=d;d=c[2];c[2]=c[6];c[6]=d;d=c[5];c[5]=c[7];c[7]=d;return this},transposeIntoArray:function(d){var c=this.m;d[0]=c[0];d[1]=c[3];d[2]=c[6];d[3]=c[1];d[4]=c[4];d[5]=c[7];d[6]=c[2];d[7]=c[5];d[8]=c[8];return this}};THREE.Matrix4=function(F,E,D,C,A,B,z,y,t,u,w,x,s,r,q,v){this.set(F!==void 0?F:1,E||0,D||0,C||0,A||0,B!==void 0?B:1,z||0,y||0,t||0,u||0,w!==void 0?w:1,x||0,s||0,r||0,q||0,v!==void 0?v:1);this.flat=Array(16);this.m33=new THREE.Matrix3};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(F,E,D,C,A,B,z,y,t,u,w,x,s,r,q,v){this.n11=F;this.n12=E;this.n13=D;this.n14=C;this.n21=A;this.n22=B;this.n23=z;this.n24=y;this.n31=t;this.n32=u;this.n33=w;this.n34=x;this.n41=s;this.n42=r;this.n43=q;this.n44=v;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(b){this.set(b.n11,b.n12,b.n13,b.n14,b.n21,b.n22,b.n23,b.n24,b.n31,b.n32,b.n33,b.n34,b.n41,b.n42,b.n43,b.n44);return this},lookAt:function(h,g,l){var k=THREE.Matrix4.__v1,i=THREE.Matrix4.__v2,j=THREE.Matrix4.__v3;j.sub(h,g).normalize();if(j.length()===0){j.z=1}k.cross(l,j).normalize();k.length()===0&&(j.x+=0.0001,k.cross(l,j).normalize());i.cross(j,k).normalize();this.n11=k.x;this.n12=i.x;this.n13=j.x;this.n21=k.y;this.n22=i.y;this.n23=j.y;this.n31=k.z;this.n32=i.z;this.n33=j.z;return this},multiply:function(an,am){var al=an.n11,ak=an.n12,ai=an.n13,aj=an.n14,ah=an.n21,ag=an.n22,ab=an.n23,ac=an.n24,ae=an.n31,af=an.n32,aa=an.n33,Z=an.n34,Y=an.n41,ad=an.n42,U=an.n43,A=an.n44,X=am.n11,t=am.n12,v=am.n13,L=am.n14,R=am.n21,y=am.n22,T=am.n23,P=am.n24,V=am.n31,S=am.n32,x=am.n33,q=am.n34,ao=am.n41,M=am.n42,J=am.n43,B=am.n44;this.n11=al*X+ak*R+ai*V+aj*ao;this.n12=al*t+ak*y+ai*S+aj*M;this.n13=al*v+ak*T+ai*x+aj*J;this.n14=al*L+ak*P+ai*q+aj*B;this.n21=ah*X+ag*R+ab*V+ac*ao;this.n22=ah*t+ag*y+ab*S+ac*M;this.n23=ah*v+ag*T+ab*x+ac*J;this.n24=ah*L+ag*P+ab*q+ac*B;this.n31=ae*X+af*R+aa*V+Z*ao;this.n32=ae*t+af*y+aa*S+Z*M;this.n33=ae*v+af*T+aa*x+Z*J;this.n34=ae*L+af*P+aa*q+Z*B;this.n41=Y*X+ad*R+U*V+A*ao;this.n42=Y*t+ad*y+U*S+A*M;this.n43=Y*v+ad*T+U*x+A*J;this.n44=Y*L+ad*P+U*q+A*B;return this},multiplySelf:function(b){return this.multiply(this,b)},multiplyToArray:function(e,d,f){this.multiply(e,d);f[0]=this.n11;f[1]=this.n21;f[2]=this.n31;f[3]=this.n41;f[4]=this.n12;f[5]=this.n22;f[6]=this.n32;f[7]=this.n42;f[8]=this.n13;f[9]=this.n23;f[10]=this.n33;f[11]=this.n43;f[12]=this.n14;f[13]=this.n24;f[14]=this.n34;f[15]=this.n44;return this},multiplyScalar:function(b){this.n11*=b;this.n12*=b;this.n13*=b;this.n14*=b;this.n21*=b;this.n22*=b;this.n23*=b;this.n24*=b;this.n31*=b;this.n32*=b;this.n33*=b;this.n34*=b;this.n41*=b;this.n42*=b;this.n43*=b;this.n44*=b;return this},multiplyVector3:function(g){var e=g.x,j=g.y,i=g.z,h=1/(this.n41*e+this.n42*j+this.n43*i+this.n44);g.x=(this.n11*e+this.n12*j+this.n13*i+this.n14)*h;g.y=(this.n21*e+this.n22*j+this.n23*i+this.n24)*h;g.z=(this.n31*e+this.n32*j+this.n33*i+this.n34)*h;return g},multiplyVector4:function(g){var e=g.x,j=g.y,i=g.z,h=g.w;g.x=this.n11*e+this.n12*j+this.n13*i+this.n14*h;g.y=this.n21*e+this.n22*j+this.n23*i+this.n24*h;g.z=this.n31*e+this.n32*j+this.n33*i+this.n34*h;g.w=this.n41*e+this.n42*j+this.n43*i+this.n44*h;return g},rotateAxis:function(f){var e=f.x,h=f.y,g=f.z;f.x=e*this.n11+h*this.n12+g*this.n13;f.y=e*this.n21+h*this.n22+g*this.n23;f.z=e*this.n31+h*this.n32+g*this.n33;f.normalize();return f},crossVector:function(d){var c=new THREE.Vector4;c.x=this.n11*d.x+this.n12*d.y+this.n13*d.z+this.n14*d.w;c.y=this.n21*d.x+this.n22*d.y+this.n23*d.z+this.n24*d.w;c.z=this.n31*d.x+this.n32*d.y+this.n33*d.z+this.n34*d.w;c.w=d.w?this.n41*d.x+this.n42*d.y+this.n43*d.z+this.n44*d.w:1;return c},determinant:function(){var F=this.n11,E=this.n12,D=this.n13,C=this.n14,A=this.n21,B=this.n22,z=this.n23,y=this.n24,t=this.n31,u=this.n32,w=this.n33,x=this.n34,s=this.n41,r=this.n42,q=this.n43,v=this.n44;return C*z*u*s-D*y*u*s-C*B*w*s+E*y*w*s+D*B*x*s-E*z*x*s-C*z*t*r+D*y*t*r+C*A*w*r-F*y*w*r-D*A*x*r+F*z*x*r+C*B*t*q-E*y*t*q-C*A*u*q+F*y*u*q+E*A*x*q-F*B*x*q-D*B*t*v+E*z*t*v+D*A*u*v-F*z*u*v-E*A*w*v+F*B*w*v},transpose:function(){var b;b=this.n21;this.n21=this.n12;this.n12=b;b=this.n31;this.n31=this.n13;this.n13=b;b=this.n32;this.n32=this.n23;this.n23=b;b=this.n41;this.n41=this.n14;this.n14=b;b=this.n42;this.n42=this.n24;this.n24=b;b=this.n43;this.n43=this.n34;this.n43=b;return this},clone:function(){var b=new THREE.Matrix4;b.n11=this.n11;b.n12=this.n12;b.n13=this.n13;b.n14=this.n14;b.n21=this.n21;b.n22=this.n22;b.n23=this.n23;b.n24=this.n24;b.n31=this.n31;b.n32=this.n32;b.n33=this.n33;b.n34=this.n34;b.n41=this.n41;b.n42=this.n42;b.n43=this.n43;b.n44=this.n44;return b},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(b){b[0]=this.n11;b[1]=this.n21;b[2]=this.n31;b[3]=this.n41;b[4]=this.n12;b[5]=this.n22;b[6]=this.n32;b[7]=this.n42;b[8]=this.n13;b[9]=this.n23;b[10]=this.n33;b[11]=this.n43;b[12]=this.n14;b[13]=this.n24;b[14]=this.n34;b[15]=this.n44;return b},flattenToArrayOffset:function(d,c){d[c]=this.n11;d[c+1]=this.n21;d[c+2]=this.n31;d[c+3]=this.n41;d[c+4]=this.n12;d[c+5]=this.n22;d[c+6]=this.n32;d[c+7]=this.n42;d[c+8]=this.n13;d[c+9]=this.n23;d[c+10]=this.n33;d[c+11]=this.n43;d[c+12]=this.n14;d[c+13]=this.n24;d[c+14]=this.n34;d[c+15]=this.n44;return d},setTranslation:function(e,d,f){this.set(1,0,0,e,0,1,0,d,0,0,1,f,0,0,0,1);return this},setScale:function(e,d,f){this.set(e,0,0,0,0,d,0,0,0,0,f,0,0,0,0,1);return this},setRotationX:function(d){var c=Math.cos(d),d=Math.sin(d);this.set(1,0,0,0,0,c,-d,0,0,d,c,0,0,0,0,1);return this},setRotationY:function(d){var c=Math.cos(d),d=Math.sin(d);this.set(c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1);return this},setRotationZ:function(d){var c=Math.cos(d),d=Math.sin(d);this.set(c,-d,0,0,d,c,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(t,s){var r=Math.cos(s),q=Math.sin(s),o=1-r,p=t.x,n=t.y,k=t.z,i=o*p,j=o*n;this.set(i*p+r,i*n-q*k,i*k+q*n,0,i*n+q*k,j*n+r,j*k-q*p,0,i*k-q*n,j*k+q*p,o*k*k+r,0,0,0,0,1);return this},setPosition:function(b){this.n14=b.x;this.n24=b.y;this.n34=b.z;return this},getPosition:function(){return THREE.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return THREE.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return THREE.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return THREE.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(G){var F=G.n11,E=G.n12,D=G.n13,B=G.n14,C=G.n21,A=G.n22,z=G.n23,u=G.n24,v=G.n31,x=G.n32,y=G.n33,t=G.n34,r=G.n41,q=G.n42,w=G.n43,H=G.n44;this.n11=z*t*q-u*y*q+u*x*w-A*t*w-z*x*H+A*y*H;this.n12=B*y*q-D*t*q-B*x*w+E*t*w+D*x*H-E*y*H;this.n13=D*u*q-B*z*q+B*A*w-E*u*w-D*A*H+E*z*H;this.n14=B*z*x-D*u*x-B*A*y+E*u*y+D*A*t-E*z*t;this.n21=u*y*r-z*t*r-u*v*w+C*t*w+z*v*H-C*y*H;this.n22=D*t*r-B*y*r+B*v*w-F*t*w-D*v*H+F*y*H;this.n23=B*z*r-D*u*r-B*C*w+F*u*w+D*C*H-F*z*H;this.n24=D*u*v-B*z*v+B*C*y-F*u*y-D*C*t+F*z*t;this.n31=A*t*r-u*x*r+u*v*q-C*t*q-A*v*H+C*x*H;this.n32=B*x*r-E*t*r-B*v*q+F*t*q+E*v*H-F*x*H;this.n33=D*u*r-B*A*r+B*C*q-F*u*q-E*C*H+F*A*H;this.n34=B*A*v-E*u*v-B*C*x+F*u*x+E*C*t-F*A*t;this.n41=z*x*r-A*y*r-z*v*q+C*y*q+A*v*w-C*x*w;this.n42=E*y*r-D*x*r+D*v*q-F*y*q-E*v*w+F*x*w;this.n43=D*A*r-E*z*r-D*C*q+F*z*q+E*C*w-F*A*w;this.n44=E*z*v-D*A*v+D*C*x-F*z*x-E*C*y+F*A*y;this.multiplyScalar(1/G.determinant());return this},setRotationFromEuler:function(x,w){var v=x.x,u=x.y,s=x.z,t=Math.cos(v),v=Math.sin(v),r=Math.cos(u),u=Math.sin(u),q=Math.cos(s),s=Math.sin(s);switch(w){case"YXZ":var k=r*q,n=r*s,o=u*q,p=u*s;this.n11=k+p*v;this.n12=o*v-n;this.n13=t*u;this.n21=t*s;this.n22=t*q;this.n23=-v;this.n31=n*v-o;this.n32=p+k*v;this.n33=t*r;break;case"ZXY":k=r*q;n=r*s;o=u*q;p=u*s;this.n11=k-p*v;this.n12=-t*s;this.n13=o+n*v;this.n21=n+o*v;this.n22=t*q;this.n23=p-k*v;this.n31=-t*u;this.n32=v;this.n33=t*r;break;case"ZYX":k=t*q;n=t*s;o=v*q;p=v*s;this.n11=r*q;this.n12=o*u-n;this.n13=k*u+p;this.n21=r*s;this.n22=p*u+k;this.n23=n*u-o;this.n31=-u;this.n32=v*r;this.n33=t*r;break;case"YZX":k=t*r;n=t*u;o=v*r;p=v*u;this.n11=r*q;this.n12=p-k*s;this.n13=o*s+n;this.n21=s;this.n22=t*q;this.n23=-v*q;this.n31=-u*q;this.n32=n*s+o;this.n33=k-p*s;break;case"XZY":k=t*r;n=t*u;o=v*r;p=v*u;this.n11=r*q;this.n12=-s;this.n13=u*q;this.n21=k*s+p;this.n22=t*q;this.n23=n*s-o;this.n31=o*s-n;this.n32=v*q;this.n33=p*s+k;break;default:k=t*q,n=t*s,o=v*q,p=v*s,this.n11=r*q,this.n12=-r*s,this.n13=u,this.n21=n+o*u,this.n22=k-p*u,this.n23=-v*r,this.n31=p-k*u,this.n32=o+n*u,this.n33=t*r}return this},setRotationFromQuaternion:function(t){var s=t.x,r=t.y,q=t.z,o=t.w,p=s+s,n=r+r,k=q+q,t=s*p,i=s*n;s*=k;var j=r*n;r*=k;q*=k;p*=o;n*=o;o*=k;this.n11=1-(j+q);this.n12=i-o;this.n13=s+n;this.n21=i+o;this.n22=1-(t+q);this.n23=r-p;this.n31=s-n;this.n32=r+p;this.n33=1-(t+j);return this},scale:function(e){var d=e.x,f=e.y,e=e.z;this.n11*=d;this.n12*=f;this.n13*=e;this.n21*=d;this.n22*=f;this.n23*=e;this.n31*=d;this.n32*=f;this.n33*=e;this.n41*=d;this.n42*=f;this.n43*=e;return this},compose:function(g,e,j){var i=THREE.Matrix4.__m1,h=THREE.Matrix4.__m2;i.identity();i.setRotationFromQuaternion(e);h.setScale(j.x,j.y,j.z);this.multiply(i,h);this.n14=g.x;this.n24=g.y;this.n34=g.z;return this},decompose:function(h,g,l){var k=THREE.Matrix4.__v1,i=THREE.Matrix4.__v2,j=THREE.Matrix4.__v3;k.set(this.n11,this.n21,this.n31);i.set(this.n12,this.n22,this.n32);j.set(this.n13,this.n23,this.n33);h=h instanceof THREE.Vector3?h:new THREE.Vector3;g=g instanceof THREE.Quaternion?g:new THREE.Quaternion;l=l instanceof THREE.Vector3?l:new THREE.Vector3;l.x=k.length();l.y=i.length();l.z=j.length();h.x=this.n14;h.y=this.n24;h.z=this.n34;k=THREE.Matrix4.__m1;k.copy(this);k.n11/=l.x;k.n21/=l.x;k.n31/=l.x;k.n12/=l.y;k.n22/=l.y;k.n32/=l.y;k.n13/=l.z;k.n23/=l.z;k.n33/=l.z;g.setFromRotationMatrix(k);return[h,g,l]},extractPosition:function(b){this.n14=b.n14;this.n24=b.n24;this.n34=b.n34;return this},extractRotation:function(f){var e=THREE.Matrix4.__v1,h=1/e.set(f.n11,f.n21,f.n31).length(),g=1/e.set(f.n12,f.n22,f.n32).length(),e=1/e.set(f.n13,f.n23,f.n33).length();this.n11=f.n11*h;this.n21=f.n21*h;this.n31=f.n31*h;this.n12=f.n12*g;this.n22=f.n22*g;this.n32=f.n32*g;this.n13=f.n13*e;this.n23=f.n23*e;this.n33=f.n33*e;return this}};THREE.Matrix4.makeInvert3x3=function(x){var w=x.m33,v=w.m,u=x.n33*x.n22-x.n32*x.n23,s=-x.n33*x.n21+x.n31*x.n23,t=x.n32*x.n21-x.n31*x.n22,r=-x.n33*x.n12+x.n32*x.n13,q=x.n33*x.n11-x.n31*x.n13,k=-x.n32*x.n11+x.n31*x.n12,n=x.n23*x.n12-x.n22*x.n13,o=-x.n23*x.n11+x.n21*x.n13,p=x.n22*x.n11-x.n21*x.n12,x=x.n11*u+x.n21*r+x.n31*n;x===0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");x=1/x;v[0]=x*u;v[1]=x*s;v[2]=x*t;v[3]=x*r;v[4]=x*q;v[5]=x*k;v[6]=x*n;v[7]=x*o;v[8]=x*p;return w};THREE.Matrix4.makeFrustum=function(i,h,n,m,k,l){var j;j=new THREE.Matrix4;j.n11=2*k/(h-i);j.n12=0;j.n13=(h+i)/(h-i);j.n14=0;j.n21=0;j.n22=2*k/(m-n);j.n23=(m+n)/(m-n);j.n24=0;j.n31=0;j.n32=0;j.n33=-(l+k)/(l-k);j.n34=-2*l*k/(l-k);j.n41=0;j.n42=0;j.n43=-1;j.n44=0;return j};THREE.Matrix4.makePerspective=function(g,e,j,i){var h,g=j*Math.tan(g*Math.PI/360);h=-g;return THREE.Matrix4.makeFrustum(h*e,g*e,h,g,j,i)};THREE.Matrix4.makeOrtho=function(t,s,r,q,o,p){var n,k,i,j;n=new THREE.Matrix4;k=s-t;i=r-q;j=p-o;n.n11=2/k;n.n12=0;n.n13=0;n.n14=-((s+t)/k);n.n21=0;n.n22=2/i;n.n23=0;n.n24=-((r+q)/i);n.n31=0;n.n32=0;n.n33=-2/j;n.n34=-((p+o)/j);n.n41=0;n.n42=0;n.n43=0;n.n44=1;return n};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Matrix4.__m1=new THREE.Matrix4;THREE.Matrix4.__m2=new THREE.Matrix4;THREE.Object3D=function(){this.name="";this.id=THREE.Object3DCount++;this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this._vector=new THREE.Vector3};THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(d,c){this.matrix.rotateAxis(c);this.position.addSelf(c.multiplyScalar(d))},translateX:function(b){this.translate(b,this._vector.set(1,0,0))},translateY:function(b){this.translate(b,this._vector.set(0,1,0))},translateZ:function(b){this.translate(b,this._vector.set(0,0,1))},lookAt:function(b){this.matrix.lookAt(b,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(d){if(this.children.indexOf(d)===-1){d.parent!==void 0&&d.parent.remove(d);d.parent=this;this.children.push(d);for(var c=this;c.parent!==void 0;){c=c.parent}c!==void 0&&c instanceof THREE.Scene&&c.addObject(d)}},remove:function(d){var c=this.children.indexOf(d);if(c!==-1){d.parent=void 0;this.children.splice(c,1);for(c=this;c.parent!==void 0;){c=c.parent}c!==void 0&&c instanceof THREE.Scene&&c.removeObject(d)}},getChildByName:function(g,e){var j,i,h;j=0;for(i=this.children.length;j<i;j++){h=this.children[j];if(h.name===g){return h}if(e&&(h=h.getChildByName(g,e),h!==void 0)){return h}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0}for(var d=0,f=this.children.length;d<f;d++){this.children[d].updateMatrixWorld(e)}}};THREE.Object3DCount=0;THREE.Projector=function(){function af(){var b=Z[ab]=Z[ab]||new THREE.RenderableObject;ab++;return b}function ae(){var b=U[T]=U[T]||new THREE.RenderableVertex;T++;return b}function ad(d,c){return c.z-d.z}function ac(j,i){var p=0,o=1,n=j.z+j.w,m=i.z+i.w,l=-j.z+j.w,k=-i.z+i.w;return n>=0&&m>=0&&l>=0&&k>=0?!0:n<0&&m<0||l<0&&k<0?!1:(n<0?p=Math.max(p,n/(n-m)):m<0&&(o=Math.min(o,n/(n-m))),l<0?p=Math.max(p,l/(l-k)):k<0&&(o=Math.min(o,l/(l-k))),o<p?!1:(j.lerpSelf(i,p),i.lerpSelf(j,1-o),!0))}var aa,ab,Z=[],Y,T,U=[],W,X,S=[],R,P=[],V,J,y=[],M,q,t=[],A={objects:[],sprites:[],lights:[],elements:[]},G=new THREE.Vector3,x=new THREE.Vector4,I=new THREE.Matrix4,B=new THREE.Matrix4,L=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],H=new THREE.Vector4,v=new THREE.Vector4;this.computeFrustum=function(d){L[0].set(d.n41-d.n11,d.n42-d.n12,d.n43-d.n13,d.n44-d.n14);L[1].set(d.n41+d.n11,d.n42+d.n12,d.n43+d.n13,d.n44+d.n14);L[2].set(d.n41+d.n21,d.n42+d.n22,d.n43+d.n23,d.n44+d.n24);L[3].set(d.n41-d.n21,d.n42-d.n22,d.n43-d.n23,d.n44-d.n24);L[4].set(d.n41-d.n31,d.n42-d.n32,d.n43-d.n33,d.n44-d.n34);L[5].set(d.n41+d.n31,d.n42+d.n32,d.n43+d.n33,d.n44+d.n34);for(d=0;d<6;d++){var c=L[d];c.divideScalar(Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z))}};this.projectVector=function(d,c){c.matrixWorldInverse.getInverse(c.matrixWorld);I.multiply(c.projectionMatrix,c.matrixWorldInverse);I.multiplyVector3(d);return d};this.unprojectVector=function(d,c){c.projectionMatrixInverse.getInverse(c.projectionMatrix);I.multiply(c.matrixWorld,c.projectionMatrixInverse);I.multiplyVector3(d);return d};this.pickingRay=function(e,d){var f;e.z=-1;f=new THREE.Vector3(e.x,e.y,1);this.unprojectVector(e,d);this.unprojectVector(f,d);f.subSelf(e).normalize();return new THREE.Ray(e,f)};this.projectGraph=function(a,e){ab=0;A.objects.length=0;A.sprites.length=0;A.lights.length=0;var c=function(f){if(f.visible!==!1){var k;if(k=f instanceof THREE.Mesh||f instanceof THREE.Line){if(!(k=f.frustumCulled===!1)){af:{for(var j=f.matrixWorld,i=-f.geometry.boundingSphere.radius*Math.max(f.scale.x,Math.max(f.scale.y,f.scale.z)),g=0;g<6;g++){if(k=L[g].x*j.n14+L[g].y*j.n24+L[g].z*j.n34+L[g].w,k<=i){k=!1;break af}}k=!0}}}k?(I.multiplyVector3(G.copy(f.position)),aa=af(),aa.object=f,aa.z=G.z,A.objects.push(aa)):f instanceof THREE.Sprite||f instanceof THREE.Particle?(I.multiplyVector3(G.copy(f.position)),aa=af(),aa.object=f,aa.z=G.z,A.sprites.push(aa)):f instanceof THREE.Light&&A.lights.push(f);k=0;for(j=f.children.length;k<j;k++){c(f.children[k])}}};c(a);e&&A.objects.sort(ad);return A};this.projectScene=function(N,K,E){var D=K.near,s=K.far,o,j,u,c,n,d,h,b,l,p,w,m,k,i,C,z;q=J=R=X=0;A.elements.length=0;K.parent===void 0&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),N.add(K));N.updateMatrixWorld();K.matrixWorldInverse.getInverse(K.matrixWorld);I.multiply(K.projectionMatrix,K.matrixWorldInverse);this.computeFrustum(I);A=this.projectGraph(N,!1);N=0;for(o=A.objects.length;N<o;N++){if(l=A.objects[N].object,p=l.matrixWorld,m=l.material,T=0,l instanceof THREE.Mesh){w=l.geometry;k=l.geometry.materials;c=w.vertices;i=w.faces;C=w.faceVertexUvs;w=l.matrixRotationWorld.extractRotation(p);j=0;for(u=c.length;j<u;j++){Y=ae(),Y.positionWorld.copy(c[j].position),p.multiplyVector3(Y.positionWorld),Y.positionScreen.copy(Y.positionWorld),I.multiplyVector4(Y.positionScreen),Y.positionScreen.x/=Y.positionScreen.w,Y.positionScreen.y/=Y.positionScreen.w,Y.visible=Y.positionScreen.z>D&&Y.positionScreen.z<s}c=0;for(j=i.length;c<j;c++){u=i[c];if(u instanceof THREE.Face3){if(n=U[u.a],d=U[u.b],h=U[u.c],n.visible&&d.visible&&h.visible&&(l.doubleSided||l.flipSided!=(h.positionScreen.x-n.positionScreen.x)*(d.positionScreen.y-n.positionScreen.y)-(h.positionScreen.y-n.positionScreen.y)*(d.positionScreen.x-n.positionScreen.x)<0)){b=S[X]=S[X]||new THREE.RenderableFace3,X++,W=b,W.v1.copy(n),W.v2.copy(d),W.v3.copy(h)}else{continue}}else{if(u instanceof THREE.Face4){if(n=U[u.a],d=U[u.b],h=U[u.c],b=U[u.d],n.visible&&d.visible&&h.visible&&b.visible&&(l.doubleSided||l.flipSided!=((b.positionScreen.x-n.positionScreen.x)*(d.positionScreen.y-n.positionScreen.y)-(b.positionScreen.y-n.positionScreen.y)*(d.positionScreen.x-n.positionScreen.x)<0||(d.positionScreen.x-h.positionScreen.x)*(b.positionScreen.y-h.positionScreen.y)-(d.positionScreen.y-h.positionScreen.y)*(b.positionScreen.x-h.positionScreen.x)<0))){z=P[R]=P[R]||new THREE.RenderableFace4,R++,W=z,W.v1.copy(n),W.v2.copy(d),W.v3.copy(h),W.v4.copy(b)}else{continue}}}W.normalWorld.copy(u.normal);w.multiplyVector3(W.normalWorld);W.centroidWorld.copy(u.centroid);p.multiplyVector3(W.centroidWorld);W.centroidScreen.copy(W.centroidWorld);I.multiplyVector3(W.centroidScreen);h=u.vertexNormals;n=0;for(d=h.length;n<d;n++){b=W.vertexNormalsWorld[n],b.copy(h[n]),w.multiplyVector3(b)}n=0;for(d=C.length;n<d;n++){if(z=C[n][c]){h=0;for(b=z.length;h<b;h++){W.uvs[n][h]=z[h]}}}W.material=m;W.faceMaterial=u.materialIndex!==null?k[u.materialIndex]:null;W.z=W.centroidScreen.z;A.elements.push(W)}}else{if(l instanceof THREE.Line){B.multiply(I,p);c=l.geometry.vertices;n=ae();n.positionScreen.copy(c[0].position);B.multiplyVector4(n.positionScreen);j=1;for(u=c.length;j<u;j++){if(n=ae(),n.positionScreen.copy(c[j].position),B.multiplyVector4(n.positionScreen),d=U[T-2],H.copy(n.positionScreen),v.copy(d.positionScreen),ac(H,v)){H.multiplyScalar(1/H.w),v.multiplyScalar(1/v.w),l=y[J]=y[J]||new THREE.RenderableLine,J++,V=l,V.v1.positionScreen.copy(H),V.v2.positionScreen.copy(v),V.z=Math.max(H.z,v.z),V.material=m,A.elements.push(V)}}}}}N=0;for(o=A.sprites.length;N<o;N++){if(l=A.sprites[N].object,p=l.matrixWorld,l instanceof THREE.Particle&&(x.set(p.n14,p.n24,p.n34,1),I.multiplyVector4(x),x.z/=x.w,x.z>0&&x.z<1)){D=t[q]=t[q]||new THREE.RenderableParticle,q++,M=D,M.x=x.x/x.w,M.y=x.y/x.w,M.z=x.z,M.rotation=l.rotation.z,M.scale.x=l.scale.x*Math.abs(M.x-(x.x+K.projectionMatrix.n11)/(x.w+K.projectionMatrix.n14)),M.scale.y=l.scale.y*Math.abs(M.y-(x.y+K.projectionMatrix.n22)/(x.w+K.projectionMatrix.n24)),M.material=l.material,A.elements.push(M)}}E&&A.elements.sort(ad);return A}};THREE.Quaternion=function(f,e,h,g){this.set(f||0,e||0,h||0,g!==void 0?g:1)};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(f,e,h,g){this.x=f;this.y=e;this.z=h;this.w=g;return this},copy:function(b){this.x=b.x;this.y=b.y;this.z=b.z;this.w=b.w;return this},setFromEuler:function(j){var i=Math.PI/360,p=j.x*i,o=j.y*i,m=j.z*i,j=Math.cos(o),o=Math.sin(o),i=Math.cos(-m),m=Math.sin(-m),n=Math.cos(p),p=Math.sin(p),l=j*i,k=o*m;this.w=l*n-k*p;this.x=l*p+k*n;this.y=o*i*n+j*m*p;this.z=j*m*n-o*i*p;return this},setFromAxisAngle:function(f,e){var h=e/2,g=Math.sin(h);this.x=f.x*g;this.y=f.y*g;this.z=f.z*g;this.w=Math.cos(h);return this},setFromRotationMatrix:function(d){var c=Math.pow(d.determinant(),1/3);this.w=Math.sqrt(Math.max(0,c+d.n11+d.n22+d.n33))/2;this.x=Math.sqrt(Math.max(0,c+d.n11-d.n22-d.n33))/2;this.y=Math.sqrt(Math.max(0,c-d.n11+d.n22-d.n33))/2;this.z=Math.sqrt(Math.max(0,c-d.n11-d.n22+d.n33))/2;this.x=d.n32-d.n23<0?-Math.abs(this.x):Math.abs(this.x);this.y=d.n13-d.n31<0?-Math.abs(this.y):Math.abs(this.y);this.z=d.n21-d.n12<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var b=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);b===0?this.w=this.z=this.y=this.x=0:(b=1/b,this.x*=b,this.y*=b,this.z*=b,this.w*=b);return this},multiplySelf:function(j){var i=this.x,p=this.y,o=this.z,m=this.w,n=j.x,l=j.y,k=j.z,j=j.w;this.x=i*j+m*n+p*k-o*l;this.y=p*j+m*l+o*n-i*k;this.z=o*j+m*k+i*l-p*n;this.w=m*j-i*n-p*l-o*k;return this},multiply:function(d,c){this.x=d.x*c.w+d.y*c.z-d.z*c.y+d.w*c.x;this.y=-d.x*c.z+d.y*c.w+d.z*c.x+d.w*c.y;this.z=d.x*c.y-d.y*c.x+d.z*c.w+d.w*c.z;this.w=-d.x*c.x-d.y*c.y-d.z*c.z+d.w*c.w;return this},multiplyVector3:function(x,w){w||(w=x);var v=x.x,u=x.y,s=x.z,t=this.x,r=this.y,q=this.z,k=this.w,n=k*v+r*s-q*u,o=k*u+q*v-t*s,p=k*s+t*u-r*v,v=-t*v-r*u-q*s;w.x=n*k+v*-t+o*-q-p*-r;w.y=o*k+v*-r+p*-t-n*-q;w.z=p*k+v*-q+n*-r-o*-t;return w}};THREE.Quaternion.slerp=function(h,g,l,k){var i=h.w*g.w+h.x*g.x+h.y*g.y+h.z*g.z;i<0?(l.w=-g.w,l.x=-g.x,l.y=-g.y,l.z=-g.z,i=-i):l.copy(g);if(Math.abs(i)>=1){return l.w=h.w,l.x=h.x,l.y=h.y,l.z=h.z,l}var j=Math.acos(i),i=Math.sqrt(1-i*i);if(Math.abs(i)<0.001){return l.w=0.5*(h.w+g.w),l.x=0.5*(h.x+g.x),l.y=0.5*(h.y+g.y),l.z=0.5*(h.z+g.z),l}g=Math.sin((1-k)*j)/i;k=Math.sin(k*j)/i;l.w=h.w*g+l.w*k;l.x=h.x*g+l.x*k;l.y=h.y*g+l.y*k;l.z=h.z*g+l.z*k;return l};THREE.Vertex=function(b){this.position=b||new THREE.Vector3};THREE.Face3=function(h,g,l,k,i,j){this.a=h;this.b=g;this.c=l;this.normal=k instanceof THREE.Vector3?k:new THREE.Vector3;this.vertexNormals=k instanceof Array?k:[];this.color=i instanceof THREE.Color?i:new THREE.Color;this.vertexColors=i instanceof Array?i:[];this.vertexTangents=[];this.materialIndex=j;this.centroid=new THREE.Vector3};THREE.Face4=function(i,h,n,m,k,l,j){this.a=i;this.b=h;this.c=n;this.d=m;this.normal=k instanceof THREE.Vector3?k:new THREE.Vector3;this.vertexNormals=k instanceof Array?k:[];this.color=l instanceof THREE.Color?l:new THREE.Color;this.vertexColors=l instanceof Array?l:[];this.vertexTangents=[];this.materialIndex=j;this.centroid=new THREE.Vector3};THREE.UV=function(d,c){this.u=d||0;this.v=c||0};THREE.UV.prototype={constructor:THREE.UV,set:function(d,c){this.u=d;this.v=c;return this},copy:function(b){this.u=b.u;this.v=b.v;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=!1};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(i){var h=new THREE.Matrix4;h.extractRotation(i,new THREE.Vector3(1,1,1));for(var n=0,m=this.vertices.length;n<m;n++){i.multiplyVector3(this.vertices[n].position)}n=0;for(m=this.faces.length;n<m;n++){var k=this.faces[n];h.multiplyVector3(k.normal);for(var l=0,j=k.vertexNormals.length;l<j;l++){h.multiplyVector3(k.vertexNormals[l])}i.multiplyVector3(k.centroid)}},computeCentroids:function(){var e,d,f;e=0;for(d=this.faces.length;e<d;e++){f=this.faces[e],f.centroid.set(0,0,0),f instanceof THREE.Face3?(f.centroid.addSelf(this.vertices[f.a].position),f.centroid.addSelf(this.vertices[f.b].position),f.centroid.addSelf(this.vertices[f.c].position),f.centroid.divideScalar(3)):f instanceof THREE.Face4&&(f.centroid.addSelf(this.vertices[f.a].position),f.centroid.addSelf(this.vertices[f.b].position),f.centroid.addSelf(this.vertices[f.c].position),f.centroid.addSelf(this.vertices[f.d].position),f.centroid.divideScalar(4))}},computeFaceNormals:function(){var j,i,p,o,m,n,l=new THREE.Vector3,k=new THREE.Vector3;j=0;for(i=this.faces.length;j<i;j++){p=this.faces[j],o=this.vertices[p.a],m=this.vertices[p.b],n=this.vertices[p.c],l.sub(n.position,m.position),k.sub(o.position,m.position),l.crossSelf(k),l.isZero()||l.normalize(),p.normal.copy(l)}},computeVertexNormals:function(){var f,e,h,g;if(this.__tmpVertices===void 0){g=this.__tmpVertices=Array(this.vertices.length);f=0;for(e=this.vertices.length;f<e;f++){g[f]=new THREE.Vector3}f=0;for(e=this.faces.length;f<e;f++){if(h=this.faces[f],h instanceof THREE.Face3){h.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else{if(h instanceof THREE.Face4){h.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}}}else{g=this.__tmpVertices;f=0;for(e=this.vertices.length;f<e;f++){g[f].set(0,0,0)}}f=0;for(e=this.faces.length;f<e;f++){h=this.faces[f],h instanceof THREE.Face3?(g[h.a].addSelf(h.normal),g[h.b].addSelf(h.normal),g[h.c].addSelf(h.normal)):h instanceof THREE.Face4&&(g[h.a].addSelf(h.normal),g[h.b].addSelf(h.normal),g[h.c].addSelf(h.normal),g[h.d].addSelf(h.normal))}f=0;for(e=this.vertices.length;f<e;f++){g[f].normalize()}f=0;for(e=this.faces.length;f<e;f++){h=this.faces[f],h instanceof THREE.Face3?(h.vertexNormals[0].copy(g[h.a]),h.vertexNormals[1].copy(g[h.b]),h.vertexNormals[2].copy(g[h.c])):h instanceof THREE.Face4&&(h.vertexNormals[0].copy(g[h.a]),h.vertexNormals[1].copy(g[h.b]),h.vertexNormals[2].copy(g[h.c]),h.vertexNormals[3].copy(g[h.d]))}},computeTangents:function(){function al(h,g,m,l,k,i,j){ae=h.vertices[g].position;Z=h.vertices[m].position;aa=h.vertices[l].position;ac=af[k];ad=af[i];Y=af[j];X=Z.x-ae.x;V=aa.x-ae.x;ab=Z.y-ae.y;S=aa.y-ae.y;A=Z.z-ae.z;U=aa.z-ae.z;t=ad.u-ac.u;v=Y.u-ac.u;I=ad.v-ac.v;M=Y.v-ac.v;y=1/(t*M-v*I);P.set((M*X-I*V)*y,(M*ab-I*S)*y,(M*A-I*U)*y);x.set((t*V-v*X)*y,(t*S-v*ab)*y,(t*U-v*A)*y);L[g].addSelf(P);L[m].addSelf(P);L[l].addSelf(P);T[g].addSelf(x);T[m].addSelf(x);T[l].addSelf(x)}var ak,aj,ai,ag,ah,af,ae,Z,aa,ac,ad,Y,X,V,ab,S,A,U,t,v,I,M,y,R,L=[],T=[],P=new THREE.Vector3,x=new THREE.Vector3,q=new THREE.Vector3,am=new THREE.Vector3,J=new THREE.Vector3;ak=0;for(aj=this.vertices.length;ak<aj;ak++){L[ak]=new THREE.Vector3,T[ak]=new THREE.Vector3}ak=0;for(aj=this.faces.length;ak<aj;ak++){ah=this.faces[ak],af=this.faceVertexUvs[0][ak],ah instanceof THREE.Face3?al(this,ah.a,ah.b,ah.c,0,1,2):ah instanceof THREE.Face4&&(al(this,ah.a,ah.b,ah.c,0,1,2),al(this,ah.a,ah.b,ah.d,0,1,3))}var B=["a","b","c","d"];ak=0;for(aj=this.faces.length;ak<aj;ak++){ah=this.faces[ak];for(ai=0;ai<ah.vertexNormals.length;ai++){J.copy(ah.vertexNormals[ai]),ag=ah[B[ai]],R=L[ag],q.copy(R),q.subSelf(J.multiplyScalar(J.dot(R))).normalize(),am.cross(ah.vertexNormals[ai],R),ag=am.dot(T[ag]),ag=ag<0?-1:1,ah.vertexTangents[ai]=new THREE.Vector4(q.x,q.y,q.z,ag)}}this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var d=1,f=this.vertices.length;d<f;d++){e=this.vertices[d];if(e.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=e.position.x}else{if(e.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=e.position.x}}if(e.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=e.position.y}else{if(e.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=e.position.y}}if(e.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=e.position.z}else{if(e.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=e.position.z}}}}},computeBoundingSphere:function(){for(var e=0,d=0,f=this.vertices.length;d<f;d++){e=Math.max(e,this.vertices[d].position.length())}this.boundingSphere={radius:e}},mergeVertices:function(){var i={},h=[],n=[],m,k=Math.pow(10,4),l,j;l=0;for(j=this.vertices.length;l<j;l++){m=this.vertices[l].position,m=[Math.round(m.x*k),Math.round(m.y*k),Math.round(m.z*k)].join("_"),i[m]===void 0?(i[m]=l,h.push(this.vertices[l]),n[l]=h.length-1):n[l]=n[i[m]]}l=0;for(j=this.faces.length;l<j;l++){if(i=this.faces[l],i instanceof THREE.Face3){i.a=n[i.a],i.b=n[i.b],i.c=n[i.c]}else{if(i instanceof THREE.Face4){i.a=n[i.a],i.b=n[i.b],i.c=n[i.c],i.d=n[i.d]}}}this.vertices=h}};THREE.GeometryCount=0;THREE.Camera=function(){if(arguments.length){return console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])}THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(b){this.matrix.lookAt(this.position,b,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)};THREE.OrthographicCamera=function(h,g,l,k,i,j){THREE.Camera.call(this);this.left=h;this.right=g;this.top=l;this.bottom=k;this.near=i!==void 0?i:0.1;this.far=j!==void 0?j:2000;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=new THREE.Camera;THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(f,e,h,g){THREE.Camera.call(this);this.fov=f!==void 0?f:50;this.aspect=e!==void 0?e:1;this.near=h!==void 0?h:0.1;this.far=g!==void 0?g:2000;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=new THREE.Camera;THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(d,c){this.fov=2*Math.atan((c!==void 0?c:43.25)/(d*2));this.fov*=180/Math.PI;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(h,g,l,k,i,j){this.fullWidth=h;this.fullHeight=g;this.x=l;this.y=k;this.width=i;this.height=j;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var f=this.fullWidth/this.fullHeight,e=Math.tan(this.fov*Math.PI/360)*this.near,h=-e,g=f*h,f=Math.abs(f*e-g),h=Math.abs(e-h);this.projectionMatrix=THREE.Matrix4.makeFrustum(g+this.x*f/this.fullWidth,g+(this.x+this.width)*f/this.fullWidth,e-(this.y+this.height)*h/this.fullHeight,e-this.y*h/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.Light=function(b){THREE.Object3D.call(this);this.color=new THREE.Color(b)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(b){THREE.Light.call(this,b)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(e,d,f){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,1,0);this.intensity=d!==void 0?d:1;this.distance=f!==void 0?f:0};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(e,d,f){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,0,0);this.intensity=d!==void 0?d:1;this.distance=f!==void 0?f:0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.Material=function(b){this.name="";this.id=THREE.MaterialCount++;b=b||{};this.opacity=b.opacity!==void 0?b.opacity:1;this.transparent=b.transparent!==void 0?b.transparent:!1;this.blending=b.blending!==void 0?b.blending:THREE.NormalBlending;this.depthTest=b.depthTest!==void 0?b.depthTest:!0;this.depthWrite=b.depthWrite!==void 0?b.depthWrite:!0;this.polygonOffset=b.polygonOffset!==void 0?b.polygonOffset:!1;this.polygonOffsetFactor=b.polygonOffsetFactor!==void 0?b.polygonOffsetFactor:0;this.polygonOffsetUnits=b.polygonOffsetUnits!==void 0?b.polygonOffsetUnits:0;this.alphaTest=b.alphaTest!==void 0?b.alphaTest:0;this.overdraw=b.overdraw!==void 0?b.overdraw:!1};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.LineBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.linewidth=b.linewidth!==void 0?b.linewidth:1;this.linecap=b.linecap!==void 0?b.linecap:"round";this.linejoin=b.linejoin!==void 0?b.linejoin:"round";this.vertexColors=b.vertexColors?b.vertexColors:!1;this.fog=b.fog!==void 0?b.fog:!0};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.fog=b.fog!==void 0?b.fog:!0;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==void 0?new THREE.Color(b.ambient):new THREE.Color(328965);this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.fog=b.fog!==void 0?b.fog:!0;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.ambient=b.ambient!==void 0?new THREE.Color(b.ambient):new THREE.Color(328965);this.specular=b.specular!==void 0?new THREE.Color(b.specular):new THREE.Color(1118481);this.shininess=b.shininess!==void 0?b.shininess:30;this.metal=b.metal!==void 0?b.metal:!1;this.perPixel=b.perPixel!==void 0?b.perPixel:!1;this.map=b.map!==void 0?b.map:null;this.lightMap=b.lightMap!==void 0?b.lightMap:null;this.envMap=b.envMap!==void 0?b.envMap:null;this.combine=b.combine!==void 0?b.combine:THREE.MultiplyOperation;this.reflectivity=b.reflectivity!==void 0?b.reflectivity:1;this.refractionRatio=b.refractionRatio!==void 0?b.refractionRatio:0.98;this.fog=b.fog!==void 0?b.fog:!0;this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1;this.wireframeLinecap=b.wireframeLinecap!==void 0?b.wireframeLinecap:"round";this.wireframeLinejoin=b.wireframeLinejoin!==void 0?b.wireframeLinejoin:"round";this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.skinning=b.skinning!==void 0?b.skinning:!1;this.morphTargets=b.morphTargets!==void 0?b.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading!==void 0?b.shading:THREE.SmoothShading;this.wireframe=b.wireframe!==void 0?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth!==void 0?b.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.shading=b.shading?b.shading:THREE.FlatShading;this.wireframe=b.wireframe?b.wireframe:!1;this.wireframeLinewidth=b.wireframeLinewidth?b.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.ParticleBasicMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map!==void 0?b.map:null;this.size=b.size!==void 0?b.size:1;this.sizeAttenuation=b.sizeAttenuation!==void 0?b.sizeAttenuation:!0;this.vertexColors=b.vertexColors!==void 0?b.vertexColors:!1;this.fog=b.fog!==void 0?b.fog:!0};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ParticleCanvasMaterial=function(b){THREE.Material.call(this,b);b=b||{};this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.program=b.program!==void 0?b.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.Texture=function(h,g,l,k,i,j){this.id=THREE.TextureCount++;this.image=h;this.mapping=g!==void 0?g:new THREE.UVMapping;this.wrapS=l!==void 0?l:THREE.ClampToEdgeWrapping;this.wrapT=k!==void 0?k:THREE.ClampToEdgeWrapping;this.magFilter=i!==void 0?i:THREE.LinearFilter;this.minFilter=j!==void 0?j:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.needsUpdate=!1;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var b=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);b.offset.copy(this.offset);b.repeat.copy(this.repeat);return b}};THREE.TextureCount=0;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(b){THREE.Object3D.call(this);this.material=b};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.Line=function(e,d,f){THREE.Object3D.call(this);this.geometry=e;this.material=d;this.type=f!==void 0?f:THREE.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(e,d){THREE.Object3D.call(this);this.geometry=e;this.material=d;if(d instanceof Array){console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=d[0]}if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var f=0;f<this.geometry.morphTargets.length;f++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[f].name]=f}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(b){if(this.morphTargetDictionary[b]!==void 0){return this.morphTargetDictionary[b]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+b+" does not exist. Returning 0.");return 0};THREE.Bone=function(b){THREE.Object3D.call(this);this.skin=b;this.skinMatrix=new THREE.Matrix4};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;THREE.Bone.prototype.update=function(f,e){this.matrixAutoUpdate&&(e|=this.updateMatrix());if(e||this.matrixWorldNeedsUpdate){f?this.skinMatrix.multiply(f,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0}var h,g=this.children.length;for(h=0;h<g;h++){this.children[h].update(this.skinMatrix,e)}};THREE.Sprite=function(b){THREE.Object3D.call(this);this.color=b.color!==void 0?new THREE.Color(b.color):new THREE.Color(16777215);this.map=b.map instanceof THREE.Texture?b.map:THREE.ImageUtils.loadTexture(b.map);this.blending=b.blending!==void 0?b.blending:THREE.NormalBlending;this.useScreenCoordinates=b.useScreenCoordinates!==void 0?b.useScreenCoordinates:!0;this.mergeWith3D=b.mergeWith3D!==void 0?b.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=b.affectedByDistance!==void 0?b.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=b.scaleByViewport!==void 0?b.scaleByViewport:!this.affectedByDistance;this.alignment=b.alignment instanceof THREE.Vector2?b.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=!1;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.addObject=function(d){if(d instanceof THREE.Light){this.lights.indexOf(d)===-1&&this.lights.push(d)}else{if(!(d instanceof THREE.Camera||d instanceof THREE.Bone)&&this.objects.indexOf(d)===-1){this.objects.push(d);this.__objectsAdded.push(d);var c=this.__objectsRemoved.indexOf(d);c!==-1&&this.__objectsRemoved.splice(c,1)}}for(c=0;c<d.children.length;c++){this.addObject(d.children[c])}};THREE.Scene.prototype.removeObject=function(d){if(d instanceof THREE.Light){var c=this.lights.indexOf(d);c!==-1&&this.lights.splice(c,1)}else{d instanceof THREE.Camera||(c=this.objects.indexOf(d),c!==-1&&(this.objects.splice(c,1),this.__objectsRemoved.push(d),c=this.__objectsAdded.indexOf(d),c!==-1&&this.__objectsAdded.splice(c,1)))}for(c=0;c<d.children.length;c++){this.removeObject(d.children[c])}};THREE.CanvasRenderer=function(aF){function aE(b){if(a6!=b){au.globalAlpha=a6=b}}function aD(b){if(aP!=b){switch(b){case THREE.NormalBlending:au.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:au.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:au.globalCompositeOperation="darker"}aP=b}}function aC(b){if(aS!=b){au.strokeStyle=aS=b}}function aA(b){if(ai!=b){au.fillStyle=ai=b}}var aB=this,az,ax,ar,at=new THREE.Projector,aF=aF||{},av=aF.canvas!==void 0?aF.canvas:document.createElement("canvas"),aw,aq,ap,ao,au=av.getContext("2d"),am=new THREE.Color(0),aW=0,a6=1,aP=0,aS=null,ai=null,a3=null,af=null,a5=null,ak,an,a4,aT,aK=new THREE.RenderableVertex,ac=new THREE.RenderableVertex,a2,a1,aZ,aI,aV,a7,aN,aj,aO,aQ,aL,aX,al=new THREE.Color,a8=new THREE.Color,ah=new THREE.Color,ag=new THREE.Color,aU=new THREE.Color,bk=[],bj=[],bd,aY,q,bc,be,a0,ay,ad,U,bl,bf=new THREE.Rectangle,aH=new THREE.Rectangle,aJ=new THREE.Rectangle,bi=!1,bg=new THREE.Color,a9=new THREE.Color,aG=new THREE.Color,aM=new THREE.Vector3,ab,bm,bb,aR,bh,ae,aF=16;ab=document.createElement("canvas");ab.width=ab.height=2;bm=ab.getContext("2d");bm.fillStyle="rgba(0,0,0,1)";bm.fillRect(0,0,2,2);bb=bm.getImageData(0,0,2,2);aR=bb.data;bh=document.createElement("canvas");bh.width=bh.height=aF;ae=bh.getContext("2d");ae.translate(-aF/2,-aF/2);ae.scale(aF,aF);aF--;this.domElement=av;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.setSize=function(d,c){aw=d;aq=c;ap=Math.floor(aw/2);ao=Math.floor(aq/2);av.width=aw;av.height=aq;bf.set(-ap,-ao,ap,ao);aH.set(-ap,-ao,ap,ao);a6=1;aP=0;a5=af=a3=ai=aS=null};this.setClearColor=function(d,c){am.copy(d);aW=c;aH.set(-ap,-ao,ap,ao)};this.setClearColorHex=function(d,c){am.setHex(d);aW=c;aH.set(-ap,-ao,ap,ao)};this.clear=function(){au.setTransform(1,0,0,-1,ap,ao);aH.isEmpty()||(aH.minSelf(bf),aH.inflate(2),aW<1&&au.clearRect(Math.floor(aH.getX()),Math.floor(aH.getY()),Math.floor(aH.getWidth()),Math.floor(aH.getHeight())),aW>0&&(aD(THREE.NormalBlending),aE(1),aA("rgba("+Math.floor(am.r*255)+","+Math.floor(am.g*255)+","+Math.floor(am.b*255)+","+aW+")"),au.fillRect(Math.floor(aH.getX()),Math.floor(aH.getY()),Math.floor(aH.getWidth()),Math.floor(aH.getHeight()))),aH.empty())};this.render=function(D,z){function A(j){var i,w,s,n;bg.setRGB(0,0,0);a9.setRGB(0,0,0);aG.setRGB(0,0,0);i=0;for(w=j.length;i<w;i++){s=j[i],n=s.color,s instanceof THREE.AmbientLight?(bg.r+=n.r,bg.g+=n.g,bg.b+=n.b):s instanceof THREE.DirectionalLight?(a9.r+=n.r,a9.g+=n.g,a9.b+=n.b):s instanceof THREE.PointLight&&(aG.r+=n.r,aG.g+=n.g,aG.b+=n.b)}}function v(I,H,G,F){var E,C,w,s,i,n;E=0;for(C=I.length;E<C;E++){w=I[E],s=w.color,w instanceof THREE.DirectionalLight?(i=w.matrixWorld.getPosition(),n=G.dot(i),n<=0||(n*=w.intensity,F.r+=s.r*n,F.g+=s.g*n,F.b+=s.b*n)):w instanceof THREE.PointLight&&(i=w.matrixWorld.getPosition(),n=G.dot(aM.sub(i,H).normalize()),n<=0||(n*=w.distance==0?1:1-Math.min(H.distanceTo(i)/w.distance,1),n!=0&&(n*=w.intensity,F.r+=s.r*n,F.g+=s.g*n,F.b+=s.b*n)))}}function r(J,I,H){aE(H.opacity);aD(H.blending);var G,E,F,C,s,w;if(H instanceof THREE.ParticleBasicMaterial){if(H.map){C=H.map.image,s=C.width>>1,w=C.height>>1,H=I.scale.x*ap,F=I.scale.y*ao,G=H*s,E=F*w,aJ.set(J.x-G,J.y-E,J.x+G,J.y+E),bf.intersects(aJ)&&(au.save(),au.translate(J.x,J.y),au.rotate(-I.rotation),au.scale(H,-F),au.translate(-s,-w),au.drawImage(C,0,0),au.restore())}}else{H instanceof THREE.ParticleCanvasMaterial&&(G=I.scale.x*ap,E=I.scale.y*ao,aJ.set(J.x-G,J.y-E,J.x+G,J.y+E),bf.intersects(aJ)&&(aC(H.color.getContextStyle()),aA(H.color.getContextStyle()),au.save(),au.translate(J.x,J.y),au.rotate(-I.rotation),au.scale(G,E),H.program(au),au.restore()))}}function p(i,s,n,j){aE(j.opacity);aD(j.blending);au.beginPath();au.moveTo(i.positionScreen.x,i.positionScreen.y);au.lineTo(s.positionScreen.x,s.positionScreen.y);au.closePath();if(j instanceof THREE.LineBasicMaterial){i=j.linewidth;if(a3!=i){au.lineWidth=a3=i}i=j.linecap;if(af!=i){au.lineCap=af=i}i=j.linejoin;if(a5!=i){au.lineJoin=a5=i}aC(j.color.getContextStyle());au.stroke();aJ.inflate(j.linewidth*2)}}function t(j,G,F,C,w,n,s,E){aB.info.render.vertices+=3;aB.info.render.faces++;aE(E.opacity);aD(E.blending);a2=j.positionScreen.x;a1=j.positionScreen.y;aZ=G.positionScreen.x;aI=G.positionScreen.y;aV=F.positionScreen.x;a7=F.positionScreen.y;l(a2,a1,aZ,aI,aV,a7);if(E instanceof THREE.MeshBasicMaterial){if(E.map){E.map.mapping instanceof THREE.UVMapping&&(bc=s.uvs[0],d(a2,a1,aZ,aI,aV,a7,bc[C].u,bc[C].v,bc[w].u,bc[w].v,bc[n].u,bc[n].v,E.map))}else{if(E.envMap){if(E.envMap.mapping instanceof THREE.SphericalReflectionMapping){j=z.matrixWorldInverse,aM.copy(s.vertexNormalsWorld[C]),be=(aM.x*j.n11+aM.y*j.n12+aM.z*j.n13)*0.5+0.5,a0=-(aM.x*j.n21+aM.y*j.n22+aM.z*j.n23)*0.5+0.5,aM.copy(s.vertexNormalsWorld[w]),ay=(aM.x*j.n11+aM.y*j.n12+aM.z*j.n13)*0.5+0.5,ad=-(aM.x*j.n21+aM.y*j.n22+aM.z*j.n23)*0.5+0.5,aM.copy(s.vertexNormalsWorld[n]),U=(aM.x*j.n11+aM.y*j.n12+aM.z*j.n13)*0.5+0.5,bl=-(aM.x*j.n21+aM.y*j.n22+aM.z*j.n23)*0.5+0.5,d(a2,a1,aZ,aI,aV,a7,be,a0,ay,ad,U,bl,E.envMap)}}else{E.wireframe?b(E.color,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):x(E.color)}}}else{if(E instanceof THREE.MeshLambertMaterial){E.map&&!E.wireframe&&(E.map.mapping instanceof THREE.UVMapping&&(bc=s.uvs[0],d(a2,a1,aZ,aI,aV,a7,bc[C].u,bc[C].v,bc[w].u,bc[w].v,bc[n].u,bc[n].v,E.map)),aD(THREE.SubtractiveBlending)),bi?!E.wireframe&&E.shading==THREE.SmoothShading&&s.vertexNormalsWorld.length==3?(a8.r=ah.r=ag.r=bg.r,a8.g=ah.g=ag.g=bg.g,a8.b=ah.b=ag.b=bg.b,v(ar,s.v1.positionWorld,s.vertexNormalsWorld[0],a8),v(ar,s.v2.positionWorld,s.vertexNormalsWorld[1],ah),v(ar,s.v3.positionWorld,s.vertexNormalsWorld[2],ag),a8.r=Math.max(0,Math.min(E.color.r*a8.r,1)),a8.g=Math.max(0,Math.min(E.color.g*a8.g,1)),a8.b=Math.max(0,Math.min(E.color.b*a8.b,1)),ah.r=Math.max(0,Math.min(E.color.r*ah.r,1)),ah.g=Math.max(0,Math.min(E.color.g*ah.g,1)),ah.b=Math.max(0,Math.min(E.color.b*ah.b,1)),ag.r=Math.max(0,Math.min(E.color.r*ag.r,1)),ag.g=Math.max(0,Math.min(E.color.g*ag.g,1)),ag.b=Math.max(0,Math.min(E.color.b*ag.b,1)),aU.r=(ah.r+ag.r)*0.5,aU.g=(ah.g+ag.g)*0.5,aU.b=(ah.b+ag.b)*0.5,q=o(a8,ah,ag,aU),y(a2,a1,aZ,aI,aV,a7,0,0,1,0,0,1,q)):(al.r=bg.r,al.g=bg.g,al.b=bg.b,v(ar,s.centroidWorld,s.normalWorld,al),al.r=Math.max(0,Math.min(E.color.r*al.r,1)),al.g=Math.max(0,Math.min(E.color.g*al.g,1)),al.b=Math.max(0,Math.min(E.color.b*al.b,1)),E.wireframe?b(al,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):x(al)):E.wireframe?b(E.color,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):x(E.color)}else{if(E instanceof THREE.MeshDepthMaterial){bd=z.near,aY=z.far,a8.r=a8.g=a8.b=1-k(j.positionScreen.z,bd,aY),ah.r=ah.g=ah.b=1-k(G.positionScreen.z,bd,aY),ag.r=ag.g=ag.b=1-k(F.positionScreen.z,bd,aY),aU.r=(ah.r+ag.r)*0.5,aU.g=(ah.g+ag.g)*0.5,aU.b=(ah.b+ag.b)*0.5,q=o(a8,ah,ag,aU),y(a2,a1,aZ,aI,aV,a7,0,0,1,0,0,1,q)}else{if(E instanceof THREE.MeshNormalMaterial){al.r=c(s.normalWorld.x),al.g=c(s.normalWorld.y),al.b=c(s.normalWorld.z),E.wireframe?b(al,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):x(al)}}}}}function f(H,G,F,E,C,s,w,j,n){aB.info.render.vertices+=4;aB.info.render.faces++;aE(j.opacity);aD(j.blending);if(j.map||j.envMap){t(H,G,E,0,1,3,w,j,n),t(C,F,s,1,2,3,w,j,n)}else{if(a2=H.positionScreen.x,a1=H.positionScreen.y,aZ=G.positionScreen.x,aI=G.positionScreen.y,aV=F.positionScreen.x,a7=F.positionScreen.y,aN=E.positionScreen.x,aj=E.positionScreen.y,aO=C.positionScreen.x,aQ=C.positionScreen.y,aL=s.positionScreen.x,aX=s.positionScreen.y,j instanceof THREE.MeshBasicMaterial){g(a2,a1,aZ,aI,aV,a7,aN,aj),j.wireframe?b(j.color,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):x(j.color)}else{if(j instanceof THREE.MeshLambertMaterial){bi?!j.wireframe&&j.shading==THREE.SmoothShading&&w.vertexNormalsWorld.length==4?(a8.r=ah.r=ag.r=aU.r=bg.r,a8.g=ah.g=ag.g=aU.g=bg.g,a8.b=ah.b=ag.b=aU.b=bg.b,v(ar,w.v1.positionWorld,w.vertexNormalsWorld[0],a8),v(ar,w.v2.positionWorld,w.vertexNormalsWorld[1],ah),v(ar,w.v4.positionWorld,w.vertexNormalsWorld[3],ag),v(ar,w.v3.positionWorld,w.vertexNormalsWorld[2],aU),a8.r=Math.max(0,Math.min(j.color.r*a8.r,1)),a8.g=Math.max(0,Math.min(j.color.g*a8.g,1)),a8.b=Math.max(0,Math.min(j.color.b*a8.b,1)),ah.r=Math.max(0,Math.min(j.color.r*ah.r,1)),ah.g=Math.max(0,Math.min(j.color.g*ah.g,1)),ah.b=Math.max(0,Math.min(j.color.b*ah.b,1)),ag.r=Math.max(0,Math.min(j.color.r*ag.r,1)),ag.g=Math.max(0,Math.min(j.color.g*ag.g,1)),ag.b=Math.max(0,Math.min(j.color.b*ag.b,1)),aU.r=Math.max(0,Math.min(j.color.r*aU.r,1)),aU.g=Math.max(0,Math.min(j.color.g*aU.g,1)),aU.b=Math.max(0,Math.min(j.color.b*aU.b,1)),q=o(a8,ah,ag,aU),l(a2,a1,aZ,aI,aN,aj),y(a2,a1,aZ,aI,aN,aj,0,0,1,0,0,1,q),l(aO,aQ,aV,a7,aL,aX),y(aO,aQ,aV,a7,aL,aX,1,0,1,1,0,1,q)):(al.r=bg.r,al.g=bg.g,al.b=bg.b,v(ar,w.centroidWorld,w.normalWorld,al),al.r=Math.max(0,Math.min(j.color.r*al.r,1)),al.g=Math.max(0,Math.min(j.color.g*al.g,1)),al.b=Math.max(0,Math.min(j.color.b*al.b,1)),g(a2,a1,aZ,aI,aV,a7,aN,aj),j.wireframe?b(al,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):x(al)):(g(a2,a1,aZ,aI,aV,a7,aN,aj),j.wireframe?b(j.color,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):x(j.color))}else{if(j instanceof THREE.MeshNormalMaterial){al.r=c(w.normalWorld.x),al.g=c(w.normalWorld.y),al.b=c(w.normalWorld.z),g(a2,a1,aZ,aI,aV,a7,aN,aj),j.wireframe?b(al,j.wireframeLinewidth,j.wireframeLinecap,j.wireframeLinejoin):x(al)}else{if(j instanceof THREE.MeshDepthMaterial){bd=z.near,aY=z.far,a8.r=a8.g=a8.b=1-k(H.positionScreen.z,bd,aY),ah.r=ah.g=ah.b=1-k(G.positionScreen.z,bd,aY),ag.r=ag.g=ag.b=1-k(E.positionScreen.z,bd,aY),aU.r=aU.g=aU.b=1-k(F.positionScreen.z,bd,aY),q=o(a8,ah,ag,aU),l(a2,a1,aZ,aI,aN,aj),y(a2,a1,aZ,aI,aN,aj,0,0,1,0,0,1,q),l(aO,aQ,aV,a7,aL,aX),y(aO,aQ,aV,a7,aL,aX,1,0,1,1,0,1,q)}}}}}}function l(j,i,C,w,s,n){au.beginPath();au.moveTo(j,i);au.lineTo(C,w);au.lineTo(s,n);au.lineTo(j,i);au.closePath()}function g(j,i,F,E,C,w,s,n){au.beginPath();au.moveTo(j,i);au.lineTo(F,E);au.lineTo(C,w);au.lineTo(s,n);au.lineTo(j,i);au.closePath()}function b(j,i,s,n){if(a3!=i){au.lineWidth=a3=i}if(af!=s){au.lineCap=af=s}if(a5!=n){au.lineJoin=a5=n}aC(j.getContextStyle());au.stroke();aJ.inflate(i*2)}function x(i){aA(i.getContextStyle());au.fill()}function d(Q,P,O,N,M,L,K,J,I,G,E,F,H){if(H.image.width!=0){if(H.needsUpdate==!0||bk[H.id]==void 0){var C=H.wrapS==THREE.RepeatWrapping,w=H.wrapT==THREE.RepeatWrapping;bk[H.id]=au.createPattern(H.image,C&&w?"repeat":C&&!w?"repeat-x":!C&&w?"repeat-y":"no-repeat");H.needsUpdate=!1}aA(bk[H.id]);var C=H.offset.x/H.repeat.x,w=H.offset.y/H.repeat.y,S=H.image.width*H.repeat.x,R=H.image.height*H.repeat.y,K=(K+C)*S,J=(J+w)*R,I=(I+C)*S,G=(G+w)*R,E=(E+C)*S,F=(F+w)*R;O-=Q;N-=P;M-=Q;L-=P;I-=K;G-=J;E-=K;F-=J;C=I*F-E*G;if(C==0){if(bj[H.id]==void 0){P=document.createElement("canvas"),P.width=H.image.width,P.height=H.image.height,Q=P.getContext("2d"),Q.drawImage(H.image,0,0),bj[H.id]=Q.getImageData(0,0,H.image.width,H.image.height).data,delete P}P=bj[H.id];K=(Math.floor(K)+Math.floor(J)*H.image.width)*4;al.setRGB(P[K]/255,P[K+1]/255,P[K+2]/255);x(al)}else{C=1/C,H=(F*O-G*M)*C,G=(F*N-G*L)*C,O=(I*M-E*O)*C,N=(I*L-E*N)*C,Q=Q-H*K-O*J,K=P-G*K-N*J,au.save(),au.transform(H,G,O,N,Q,K),au.fill(),au.restore()}}}function y(P,O,N,M,L,K,J,I,H,G,F,E,w){var C,s;C=w.width-1;s=w.height-1;J*=C;I*=s;H*=C;G*=s;F*=C;E*=s;N-=P;M-=O;L-=P;K-=O;H-=J;G-=I;F-=J;E-=I;s=1/(H*E-F*G);C=(E*N-G*L)*s;G=(E*M-G*K)*s;N=(H*L-F*N)*s;M=(H*K-F*M)*s;P=P-C*J-N*I;O=O-G*J-M*I;au.save();au.transform(C,G,N,M,P,O);au.clip();au.drawImage(w,0,0);au.restore()}function o(L,K,J,I){var H=~~(L.r*255),G=~~(L.g*255),L=~~(L.b*255),F=~~(K.r*255),E=~~(K.g*255),K=~~(K.b*255),C=~~(J.r*255),w=~~(J.g*255),J=~~(J.b*255),s=~~(I.r*255),n=~~(I.g*255),I=~~(I.b*255);aR[0]=H<0?0:H>255?255:H;aR[1]=G<0?0:G>255?255:G;aR[2]=L<0?0:L>255?255:L;aR[4]=F<0?0:F>255?255:F;aR[5]=E<0?0:E>255?255:E;aR[6]=K<0?0:K>255?255:K;aR[8]=C<0?0:C>255?255:C;aR[9]=w<0?0:w>255?255:w;aR[10]=J<0?0:J>255?255:J;aR[12]=s<0?0:s>255?255:s;aR[13]=n<0?0:n>255?255:n;aR[14]=I<0?0:I>255?255:I;bm.putImageData(bb,0,0);ae.drawImage(ab,0,0);return bh}function k(j,i,n){j=(j-i)/(n-i);return j*j*(3-2*j)}function c(i){i=(i+1)*0.5;return i<0?0:i>1?1:i}function h(j,i){var w=i.x-j.x,s=i.y-j.y,n=w*w+s*s;n!=0&&(n=1/Math.sqrt(n),w*=n,s*=n,i.x+=w,i.y+=s,j.x-=w,j.y-=s)}var B,m,e,u;this.autoClear?this.clear():au.setTransform(1,0,0,-1,ap,ao);aB.info.render.vertices=0;aB.info.render.faces=0;az=at.projectScene(D,z,this.sortElements);ax=az.elements;ar=az.lights;(bi=ar.length>0)&&A(ar);B=0;for(m=ax.length;B<m;B++){if(e=ax[B],u=e.material,u=u instanceof THREE.MeshFaceMaterial?e.faceMaterial:u,!(u==null||u.opacity==0)){aJ.empty();if(e instanceof THREE.RenderableParticle){ak=e,ak.x*=ap,ak.y*=ao,r(ak,e,u,D)}else{if(e instanceof THREE.RenderableLine){ak=e.v1,an=e.v2,ak.positionScreen.x*=ap,ak.positionScreen.y*=ao,an.positionScreen.x*=ap,an.positionScreen.y*=ao,aJ.addPoint(ak.positionScreen.x,ak.positionScreen.y),aJ.addPoint(an.positionScreen.x,an.positionScreen.y),bf.intersects(aJ)&&p(ak,an,e,u,D)}else{if(e instanceof THREE.RenderableFace3){ak=e.v1,an=e.v2,a4=e.v3,ak.positionScreen.x*=ap,ak.positionScreen.y*=ao,an.positionScreen.x*=ap,an.positionScreen.y*=ao,a4.positionScreen.x*=ap,a4.positionScreen.y*=ao,u.overdraw&&(h(ak.positionScreen,an.positionScreen),h(an.positionScreen,a4.positionScreen),h(a4.positionScreen,ak.positionScreen)),aJ.add3Points(ak.positionScreen.x,ak.positionScreen.y,an.positionScreen.x,an.positionScreen.y,a4.positionScreen.x,a4.positionScreen.y),bf.intersects(aJ)&&t(ak,an,a4,0,1,2,e,u,D)}else{if(e instanceof THREE.RenderableFace4){ak=e.v1,an=e.v2,a4=e.v3,aT=e.v4,ak.positionScreen.x*=ap,ak.positionScreen.y*=ao,an.positionScreen.x*=ap,an.positionScreen.y*=ao,a4.positionScreen.x*=ap,a4.positionScreen.y*=ao,aT.positionScreen.x*=ap,aT.positionScreen.y*=ao,aK.positionScreen.copy(an.positionScreen),ac.positionScreen.copy(aT.positionScreen),u.overdraw&&(h(ak.positionScreen,an.positionScreen),h(an.positionScreen,aT.positionScreen),h(aT.positionScreen,ak.positionScreen),h(a4.positionScreen,aK.positionScreen),h(a4.positionScreen,ac.positionScreen)),aJ.addPoint(ak.positionScreen.x,ak.positionScreen.y),aJ.addPoint(an.positionScreen.x,an.positionScreen.y),aJ.addPoint(a4.positionScreen.x,a4.positionScreen.y),aJ.addPoint(aT.positionScreen.x,aT.positionScreen.y),bf.intersects(aJ)&&f(ak,an,a4,aT,aK,ac,e,u,D)}}}}aH.addRectangle(aJ)}}au.setTransform(1,0,0,1,0,0)}};THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(b){this.positionWorld.copy(b.positionWorld);this.positionScreen.copy(b.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.material=null};